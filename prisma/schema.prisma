generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  relationMode      = "prisma"
}

model User {
  id                     Int                     @id @default(autoincrement())
  userBadge1_id          Int?
  userBadge2_id          Int?
  userBadge3_id          Int?
  nickname               String?                 @db.VarChar(40) @default("사용자")
  gender                 Gender?
  email                  String                  @unique @db.VarChar(255)
  phoneNumber            String?                 @db.VarChar(40)
  password               String                  @db.VarChar(255)
  created_at             DateTime                @default(now())
  updated_at             DateTime                @updatedAt
  inactiveDate           DateTime?               @db.DateTime(6)
  profilePhoto           String?                 @db.VarChar(255)
  level                  Level?
  followerCount          Int
  followingCount         Int
  points                 Int                     @default(0)
  job                    Job?
  category               Category
  ageGroup               AgeGroup?
  userBadge1             UserBadge?              @relation("Badge1", fields: [userBadge1_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  userBadge2             UserBadge?              @relation("Badge2", fields: [userBadge2_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  userBadge3             UserBadge?              @relation("Badge3", fields: [userBadge3_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  challengeLikes         ChallengeLike[]
  comments               Comment[]
  posts                  Post[]
  postLikes              PostLike[]
  verifications          Verification[]
  userBadges             UserBadge[]
  userCategoryTypes      UserCategoryType[]
  scraps                 Scrap[]
  temporaryVerifications TemporaryVerification[]
  challenges             Challenge[]
  userChallenges         UserChallenge[]
  userGoals              UserGoal[]
  alarm                  Alarm[]
  followers              Follow[]                @relation("FollowerRelation")
  followings             Follow[]                @relation("FollowingRelation")
  receivedMessages       Message[]               @relation("ReceivedMessages")
  sentMessages           Message[]               @relation("SentMessages")
  userBoards             UserBoard[] 
  userAgreements         UserAgreement[]
  @@map("Users")
}

model Keyword {
  id                Int                @id @default(autoincrement())
  name              String?            @db.VarChar(40)
  challengeKeywords ChallengeKeyword[]

  @@map("Keywords")
}

model ChallengeLike {
  id           Int       @id @default(autoincrement())
  user_id      Int
  challenge_id Int
  user         User      @relation(fields: [user_id], references: [id])
  challenge    Challenge @relation(fields: [challenge_id], references: [id])

  @@map("ChallengeLikes")
}

model Comment {
  id              Int          @id @default(autoincrement())
  user_id         Int
  post_id         Int
  verification_id Int
  content         String?      @db.Text
  parent_id       Int?         //부모 댓글 ID(NULL일 때는 최상위 댓글)
  depth           Int          @default(0) //최상위 댓글은 0
  created_at      DateTime?    @db.DateTime(6)
  updated_at      DateTime?    @db.DateTime(6)
  user            User         @relation(fields: [user_id], references: [id])
  post            Post         @relation(fields: [post_id], references: [id])
  verification    Verification @relation(fields: [verification_id], references: [id])
  parent_comment  Comment?     @relation("CommentReplies", fields:[parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  child_comment   Comment[]    @relation("CommentReplies")

  @@map("Comments")
}

model UserBoard {
  id        Int       @id @default(autoincrement())
  userId    Int
  boardId   Int
  pinned    Boolean   @default(false)
  user      User      @relation(fields: [userId], references: [id])
  board     Board     @relation(fields: [boardId], references: [id])

  @@unique([userId, boardId])
  @@map("UserBoard")
}

model Board {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(40)
  description String?      @db.VarChar(255)
  posts       Post[]
  status      Boolean      @default(false)
  category    Category
  userBoards  UserBoard[]
  
  @@map("Boards")
}

model Post {
  id         Int        @id @default(autoincrement())
  user_id    Int
  board_id   Int
  title      String?    @db.VarChar(100)
  content    String?    @db.VarChar(200)
  anonymous  Boolean?
  created_at DateTime?  @default(now())
  updated_at DateTime?  @updatedAt
  user       User       @relation(fields: [user_id], references: [id])
  board      Board      @relation(fields: [board_id], references: [id])
  comments   Comment[]
  postLikes  PostLike[]

  @@map("Posts")
}

model PostLike {
  id      Int  @id @default(autoincrement())
  user_id Int
  post_id Int
  user    User @relation(fields: [user_id], references: [id])
  post    Post @relation(fields: [post_id], references: [id])

  @@map("PostLikes")
}

model Message {
  id              Int       @id @default(autoincrement())
  receivedUser_id Int
  sendUser_id     Int
  content         String?   @db.Text
  created_at      DateTime? @default(now())
  receivedUser    User      @relation("ReceivedMessages", fields: [receivedUser_id], references: [id])
  sendUser        User      @relation("SentMessages", fields: [sendUser_id], references: [id])

  @@map("Messages")
}

model Verification {
  id                     Int                     @id @default(autoincrement())
  user_id                Int
  userChallenge_id       Int
  challengeType          ChallengeType
  verificationType       VerificationType        @map("type")
  photoUrl               String?                 @db.VarChar(255)
  title                  String?                 @db.VarChar(80)
  content                String?                 @db.VarChar(200)
  question               Boolean?
  textUrl                String?                 @db.VarChar(255)
  verificationStatus     VerificationStatus      @map("status")
  created_at             DateTime?               @default(now())
  updated_at             DateTime?               @updatedAt
  deadline               DateTime?               @db.DateTime(6)
  adoptionComplete       Boolean                 @default(false)
  user                   User                    @relation(fields: [user_id], references: [id])
  userChallenge          UserChallenge           @relation(fields: [userChallenge_id], references: [id])
  comments               Comment[]
  temporaryVerifications TemporaryVerification[]
  scrapTarget1           Scrap[]                 @relation("ScrapTarget1")
  scrapTarget2           Scrap[]                 @relation("ScrapTarget2")

  @@map("Verifications")
}

model KickOut {
  id               Int           @id @default(autoincrement())
  userChallenge_id Int
  challengeType    ChallengeType
  created_at       DateTime?     @default(now())
  userChallenge    UserChallenge @relation(fields: [userChallenge_id], references: [id])

  @@map("KickOuts")
}

model Follow {
  id           Int     @id @default(autoincrement())
  follower_id  Int
  following_id Int
  follower     User    @relation("FollowerRelation", fields: [follower_id], references: [id])
  following    User    @relation("FollowingRelation", fields: [following_id], references: [id])
  alarms       Alarm[] @relation("SenderAlarm")

  @@unique([follower_id, following_id])
  @@map("Follows")
}

model Badge {
  id            Int         @id @default(autoincrement())
  name          String?     @db.VarChar(50)
  icon          String?     @db.VarChar(255)
  description   String?     @db.Text
  type          BadgeType?
  obtainedCount Int?
  profileImage  String?     @db.VarChar(255)
  userBadges    UserBadge[]
  conditions    Condition[]

  @@map("Badges")
}

model UserBadge {
  id                 Int                  @id @default(autoincrement())
  user_id            Int
  badge_id           Int
  created_at         DateTime?            @default(now())
  isObtained         Boolean
  updated_at         DateTime?            @updatedAt
  user               User                 @relation(fields: [user_id], references: [id])
  badge              Badge                @relation(fields: [badge_id], references: [id])
  userBadge1         User[]               @relation("Badge1")
  userBadge2         User[]               @relation("Badge2")
  userBadge3         User[]               @relation("Badge3")
  userBadgeCondtions UserBadgeCondition[]

  @@map("User_Badge")
}


model FavorType {
  id                Int                @id @default(autoincrement())
  name              String?            @db.VarChar(40)
  userCategoryTypes UserCategoryType[]
}

model UserCategoryType {
  id           Int
  user_id      Int
  category_id  Int
  favorType_id Int
  user         User      @relation(fields: [user_id], references: [id])
  category     Category  
  favorType    FavorType @relation(fields: [favorType_id], references: [id])

  @@id([id, user_id, category_id, favorType_id])
  @@map("User_CategoryType")
}

model Scrap {
  id              Int           @id @default(autoincrement())
  user_id         Int
  scrapTarget1_id Int
  scrapTarget2_id Int
  scrapType       ScrapType
  created_at      DateTime?     @default(now())
  user            User          @relation(fields: [user_id], references: [id])
  scrapTarget1    Verification? @relation("ScrapTarget1", fields: [scrapTarget1_id], references: [id])
  scrapTarget2    Verification? @relation("ScrapTarget2", fields: [scrapTarget2_id], references: [id])

  @@map("Scraps")
}

model TemporaryVerification {
  id              Int           @id @default(autoincrement())
  user_id         Int
  verification_id Int
  challengeType   ChallengeType
  title           String?       @db.VarChar(80)
  content         String?       @db.VarChar(255)
  created_at      DateTime?     @default(now())
  updated_at      DateTime?     @updatedAt
  user            User          @relation(fields: [user_id], references: [id])
  verification    Verification  @relation(fields: [verification_id], references: [id])

  @@map("TemporaryVerifications")
}

model Challenge {
  id                  Int                 @id @default(autoincrement())
  owner_id            Int
  name                String?             @db.VarChar(40)
  type                ChallengeType
  description         String?             @db.VarChar(255)
  challengeImage      String              @db.VarChar(255)
  challengeStatus     ChallengeStatus     @map("status")
  maxParticipants     Int?
  verificationType    VerificationType
  rule                String?             @db.Text
  joinDate            DateTime?           @db.DateTime(6)
  endDate             DateTime?           @db.DateTime(6)
  created_at          DateTime?           @db.DateTime(6)
  updated_at          DateTime?           @db.DateTime(6)
  category            Category
  user                User                @relation(fields: [owner_id], references: [id])
  challengeLikes      ChallengeLike[]
  frequencies         Frequency[]
  userChallenges      UserChallenge[]
  challengeKeywords   ChallengeKeyword[]

  @@map("Challenges")
}

model Frequency {
  id             Int           @id @default(autoincrement())
  challenge_id   Int
  frequencyType  FrequencyType
  monday         Boolean       @default(false)
  tuesday        Boolean       @default(false)
  wednesday      Boolean       @default(false)
  thursday       Boolean       @default(false)
  friday         Boolean       @default(false)
  saturday       Boolean       @default(false)
  sunday         Boolean       @default(false)
  challenge      Challenge     @relation(fields: [challenge_id], references: [id])

  @@map("Frequencies")
}

model UserChallenge {
  id                  Int                 @id @default(autoincrement())
  challenge_id        Int
  user_id             Int
  challengeStatus     ChallengeStatus
  joinDate            DateTime?           @db.DateTime(6)
  endDate             DateTime?           @db.DateTime(6)
  verifyCount         Int?
  unverifiedCount     Int?
  userChallengeStatus UserChallengeStatus @map("status")
  warn                Int                 @default(0)
  challenge           Challenge           @relation(fields: [challenge_id], references: [id])
  user                User                @relation(fields: [user_id], references: [id])
  verification        Verification[]
  kickOuts            KickOut[]

  @@map("User_Challenge")
}

model ChallengeKeyword {
  id           Int
  challenge_id Int
  keyword_id   Int
  challenge    Challenge @relation(fields: [challenge_id], references: [id])
  keyword      Keyword   @relation(fields: [keyword_id], references: [id])

  @@id([id, challenge_id, keyword_id])
  @@map("Challenge_Keyword")
}

model Goal {
  id        Int        @id @default(autoincrement())
  name      Name
  userGoals UserGoal[]

  @@map("Goals")
}

model UserGoal {
  user_id Int
  goal_id Int
  user    User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  goal    Goal @relation(fields: [goal_id], references: [id], onDelete: Cascade)

  @@id([user_id, goal_id])
  @@map("User_Goal")
}

model Alarm {
  id          Int       @id @default(autoincrement())
  user_id     Int
  sender_id   Int?
  alarmType   AlarmType
  referenceId Int       @map("reference_id")
  title       String    @db.VarChar(120)
  message     String?   @db.VarChar(255)
  isRead      Boolean?
  created_at  DateTime  @default(now())
  user        User      @relation(fields: [user_id], references: [id])
  sender      Follow?   @relation("SenderAlarm", fields: [sender_id], references: [id])

  @@map("Alarms")
}

model Condition {
  id                  Int                  @id @default(autoincrement())
  badge_id            Int
  description         String?
  badge               Badge                @relation(fields: [badge_id], references: [id])
  userBadgeConditions UserBadgeCondition[]

  @@map("Conditions")
}

model UserBadgeCondition {
  id           Int       @id @default(autoincrement())
  userBadge_id Int
  condition_id Int
  isAchieved   Boolean?
  userBadge    UserBadge @relation(fields: [userBadge_id], references: [id])
  condition    Condition @relation(fields: [condition_id], references: [id])

  @@map("User_Badge_Condition")
}

model EmailVerification {
  id               Int      @id @default(autoincrement())
  email            String   @unique
  verificationCode String  
  codeExpires      DateTime
  verified         Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model UserAgreement {
  id                  Int      @id @default(autoincrement())
  user_id             Int
  user                User     @relation(fields: [user_id], references: [id])
  agree_all           Boolean  @default(false) @map("agreeAll")
  terms_of_service    Boolean  @default(false) @map("termsOfService")
  privacy_policy      Boolean  @default(false) @map("privacyPolicy")
  third_party_provision Boolean @default(false) @map("thirdPartyProvision")
  marketing_and_ads   Boolean  @default(false) @map("marketingAndAds")
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  @@map("UserAgreements")
}

enum AlarmType {
  follow
  verificationComment
  postComment
  warning
  kickOut
  newVerification
  deadline
}

enum Name {
  health
  diet
  foodControl
  smallGoal
  studyTogether
  makeHabit
  studyRoutine
  buildCapacity
  escape_3
  qualification
}

enum ChallengeType {
  study
  basic
}

enum VerificationType {
  camera
  text
}

enum VerificationStatus {
  verified
  unverified
}

enum ScrapType {
  post
  verification
}

enum ChallengeStatus {
  open
  ongoing
  completed
}

enum FrequencyType {
  weeklyCount
  specificDays
}

enum UserChallengeStatus {
  kick
  active
}

enum Level {
  bronze
  silver
  gold
  master
  challenger
}

enum Gender {
  male
  female
}

enum Job {
  middleHighSchoolStudent
  collegeStudent
  jobSeeker
  officeWorker
  housewife
}

enum AgeGroup {
  teen    @map("10s")
  twenty  @map("20s")
  thirty  @map("30s")
  forty   @map("40s")
  fiftyUp @map("50s+")
}


enum BadgeType {
  category
  type
}

enum Category {
  exercise
  study
  hobby
  jobPreparation
  lifestyle
}